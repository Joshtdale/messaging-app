{"ast":null,"code":"// Redundant default as a workaround for this WebPack bug:\n// https://github.com/webpack/webpack/issues/4742\nconst fetch = require(\"node-fetch\").default;\nconst AbortController = require(\"abort-controller\").default;\nconst errors = require(\"./errors\");\nconst util = require(\"./util\");\nconst pusherLibraryVersion = require(\"./version\");\nconst RESERVED_QUERY_KEYS = {\n  auth_key: true,\n  auth_timestamp: true,\n  auth_version: true,\n  auth_signature: true,\n  body_md5: true\n};\nfunction send(config, options) {\n  const method = options.method;\n  const path = config.prefixPath(options.path);\n  const body = options.body ? JSON.stringify(options.body) : undefined;\n  const url = `${config.getBaseURL()}${path}?${createSignedQueryString(config.token, {\n    method,\n    path,\n    params: options.params,\n    body: body\n  })}`;\n  const headers = {\n    \"x-pusher-library\": \"pusher-http-node \" + pusherLibraryVersion\n  };\n  if (body) {\n    headers[\"content-type\"] = \"application/json\";\n  }\n  let signal;\n  let timeout;\n  if (config.timeout) {\n    const controller = new AbortController();\n    timeout = setTimeout(() => controller.abort(), config.timeout);\n    signal = controller.signal;\n  }\n  return fetch(url, {\n    method,\n    body,\n    headers,\n    signal,\n    agent: config.agent\n  }).then(res => {\n    clearTimeout(timeout);\n    if (res.status >= 400) {\n      return res.text().then(body => {\n        throw new errors.RequestError(\"Unexpected status code \" + res.status, url, undefined, res.status, body);\n      });\n    }\n    return res;\n  }, err => {\n    clearTimeout(timeout);\n    throw new errors.RequestError(\"Request failed with an error\", url, err);\n  });\n}\nfunction createSignedQueryString(token, request) {\n  const timestamp = Date.now() / 1000 | 0;\n  const params = {\n    auth_key: token.key,\n    auth_timestamp: timestamp,\n    auth_version: \"1.0\"\n  };\n  if (request.body) {\n    params.body_md5 = util.getMD5(request.body);\n  }\n  if (request.params) {\n    for (const key in request.params) {\n      if (RESERVED_QUERY_KEYS[key] !== undefined) {\n        throw Error(key + \" is a required parameter and cannot be overidden\");\n      }\n      params[key] = request.params[key];\n    }\n  }\n  const method = request.method.toUpperCase();\n  const sortedKeyVal = util.toOrderedArray(params);\n  let queryString = sortedKeyVal.join(\"&\");\n  const signData = [method, request.path, queryString].join(\"\\n\");\n  queryString += \"&auth_signature=\" + token.sign(signData);\n  return queryString;\n}\nexports.send = send;\nexports.createSignedQueryString = createSignedQueryString;","map":{"version":3,"names":["fetch","require","default","AbortController","errors","util","pusherLibraryVersion","RESERVED_QUERY_KEYS","auth_key","auth_timestamp","auth_version","auth_signature","body_md5","send","config","options","method","path","prefixPath","body","JSON","stringify","undefined","url","getBaseURL","createSignedQueryString","token","params","headers","signal","timeout","controller","setTimeout","abort","agent","then","res","clearTimeout","status","text","RequestError","err","request","timestamp","Date","now","key","getMD5","Error","toUpperCase","sortedKeyVal","toOrderedArray","queryString","join","signData","sign","exports"],"sources":["/workspace/messaging-app/app/node_modules/pusher/lib/requests.js"],"sourcesContent":["// Redundant default as a workaround for this WebPack bug:\n// https://github.com/webpack/webpack/issues/4742\nconst fetch = require(\"node-fetch\").default\nconst AbortController = require(\"abort-controller\").default\n\nconst errors = require(\"./errors\")\nconst util = require(\"./util\")\n\nconst pusherLibraryVersion = require(\"./version\")\n\nconst RESERVED_QUERY_KEYS = {\n  auth_key: true,\n  auth_timestamp: true,\n  auth_version: true,\n  auth_signature: true,\n  body_md5: true,\n}\n\nfunction send(config, options) {\n  const method = options.method\n  const path = config.prefixPath(options.path)\n  const body = options.body ? JSON.stringify(options.body) : undefined\n\n  const url = `${config.getBaseURL()}${path}?${createSignedQueryString(\n    config.token,\n    {\n      method,\n      path,\n      params: options.params,\n      body: body,\n    }\n  )}`\n\n  const headers = {\n    \"x-pusher-library\": \"pusher-http-node \" + pusherLibraryVersion,\n  }\n\n  if (body) {\n    headers[\"content-type\"] = \"application/json\"\n  }\n\n  let signal\n  let timeout\n  if (config.timeout) {\n    const controller = new AbortController()\n    timeout = setTimeout(() => controller.abort(), config.timeout)\n    signal = controller.signal\n  }\n\n  return fetch(url, {\n    method,\n    body,\n    headers,\n    signal,\n    agent: config.agent,\n  }).then(\n    (res) => {\n      clearTimeout(timeout)\n      if (res.status >= 400) {\n        return res.text().then((body) => {\n          throw new errors.RequestError(\n            \"Unexpected status code \" + res.status,\n            url,\n            undefined,\n            res.status,\n            body\n          )\n        })\n      }\n      return res\n    },\n    (err) => {\n      clearTimeout(timeout)\n      throw new errors.RequestError(\"Request failed with an error\", url, err)\n    }\n  )\n}\n\nfunction createSignedQueryString(token, request) {\n  const timestamp = (Date.now() / 1000) | 0\n\n  const params = {\n    auth_key: token.key,\n    auth_timestamp: timestamp,\n    auth_version: \"1.0\",\n  }\n\n  if (request.body) {\n    params.body_md5 = util.getMD5(request.body)\n  }\n\n  if (request.params) {\n    for (const key in request.params) {\n      if (RESERVED_QUERY_KEYS[key] !== undefined) {\n        throw Error(key + \" is a required parameter and cannot be overidden\")\n      }\n      params[key] = request.params[key]\n    }\n  }\n\n  const method = request.method.toUpperCase()\n  const sortedKeyVal = util.toOrderedArray(params)\n  let queryString = sortedKeyVal.join(\"&\")\n\n  const signData = [method, request.path, queryString].join(\"\\n\")\n  queryString += \"&auth_signature=\" + token.sign(signData)\n\n  return queryString\n}\n\nexports.send = send\nexports.createSignedQueryString = createSignedQueryString\n"],"mappings":"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"},"metadata":{},"sourceType":"script","externalDependencies":[]}